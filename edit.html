<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Edit Student Data</title>
        <link rel="icon" href="assets/img/logo.png" type="image/x-icon">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
        <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 20px;
      transition: background 0.4s ease;
    }

    h2 {
      text-align: center;
      color: #2b5876;
      margin-bottom: 24px;
    }

    .form-section {
      max-width: 600px;
      margin: auto;
      background: #fff;
      border-radius: 12px;
      padding: 28px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      animation: fadeInUp 0.6s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    label {
      font-weight: 500;
      margin-top: 10px;
    }

    select, input, button {
      margin-bottom: 16px;
    }

    #photoPreview {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      object-fit: cover;
      margin: 10px auto;
      display: block;
      border: 2px solid #ccc;
    }

    .subject-input {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    .subject-input input {
      flex: 1;
    }

    .btn-primary {
      background: #2b5876;
      border: none;
    }

    .btn-danger {
      margin-top: 10px;
    }
  </style>
    </head>
    <body>
        <h2>Edit Student Record</h2>
        <div class="form-section">
            <label for="classSelect">Select Class</label>
            <select id="classSelect" class="form-select">
                <option value="">-- Select Class --</option>
                <option value="10-A">10-A</option>
                <option value="10-B">10-B</option>
                <option value="10-C">10-C</option>
                <option value="10-D">10-D</option>
                <option value="11-A">11-A</option>
                <option value="11-B">11-B</option>
                <option value="11-C">11-C</option>
                <option value="11-D">11-D</option>
                <option value="12-A">12-A</option>
                <option value="12-B">12-B</option>
                <option value="12-C">12-C</option>
                <option value="12-D">12-D</option>
            </select>
            <label for="rollSelect">Select Roll Number</label>
            <select id="rollSelect" class="form-select">
                <option value="">-- Select Roll Number --</option>
            </select>
            <label for="nameInput">Student Name</label>
            <input type="text" id="nameInput" class="form-control" placeholder="Enter Student Name">
            <img id="photoPreview" src="assets/img/default.png" alt="Photo Preview">
            <label for="photoInput">Upload Photo</label>
            <input type="file" id="photoInput" class="form-control" accept="image/jpeg, image/png">
            <div id="subjectMarks"></div>
            <button class="btn btn-secondary w-100" onclick="addSubject()">Add Subject</button>
            <button class="btn btn-primary w-100" onclick="saveStudent()">Save</button>
            <button class="btn btn-danger w-100" onclick="deleteStudent()">Delete Student</button>
        </div>
        <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwvNbUGSrGURhInrK6trFfVUHDSqsX-0ML-5NzUxlbEOl22V-v4H_8kIbAs39lxfo4w6w/exec";

    const classSelect = document.getElementById('classSelect');
    const rollSelect = document.getElementById('rollSelect');
    const nameInput = document.getElementById('nameInput');
    const photoInput = document.getElementById('photoInput');
    const photoPreview = document.getElementById('photoPreview');
    const subjectMarksDiv = document.getElementById('subjectMarks');

    classSelect.addEventListener('change', () => {
      fetch(`${API_URL}?action=getRolls&class=${classSelect.value}`)
        .then(res => res.json())
        .then(data => {
          rollSelect.innerHTML = `<option value="">-- Select Roll Number --</option>`;
          data.forEach(roll => {
            rollSelect.innerHTML += `<option value="${roll}">${roll}</option>`;
          });
        });
    });

    rollSelect.addEventListener('change', () => {
      if (!classSelect.value || !rollSelect.value) return;
      fetch(`${API_URL}?action=getStudent&class=${classSelect.value}&rollNo=${rollSelect.value}`)
        .then(res => res.json())
        .then(student => {
          nameInput.value = student.name || '';
          photoPreview.src = student.photoUrl || 'assets/img/default.png';
          subjectMarksDiv.innerHTML = '';
          (student.subjects || []).forEach(sub => {
            subjectMarksDiv.innerHTML += `
              <div class="subject-input">
                <input type="text" value="${sub.subject}" placeholder="Subject" class="form-control subject">
                <input type="number" value="${sub.marks}" placeholder="Marks" class="form-control marks">
              </div>
            `;
          });
        });
    });

    function addSubject() {
      subjectMarksDiv.innerHTML += `
        <div class="subject-input">
          <input type="text" placeholder="Subject" class="form-control subject">
          <input type="number" placeholder="Marks" class="form-control marks">
        </div>
      `;
    }

    function saveStudent() {
      const classVal = classSelect.value;
      const rollNo = rollSelect.value;
      const name = nameInput.value.trim();
      const subjects = Array.from(document.querySelectorAll('.subject-input')).map(row => ({
        subject: row.querySelector('.subject').value.trim(),
        marks: row.querySelector('.marks').value.trim()
      })).filter(s => s.subject && s.marks);

      const formData = new FormData();
      formData.append('action', 'update');
      formData.append('class', classVal);
      formData.append('rollNo', rollNo);
      formData.append('name', name);
      formData.append('subjects', JSON.stringify(subjects));
      if (photoInput.files[0]) {
        formData.append('photo', photoInput.files[0]);
      }

      fetch(API_URL, { method: 'POST', body: formData })
        .then(res => res.text())
        .then(alert);
    }

    function deleteStudent() {
      if (!confirm("Are you sure to delete this student?")) return;
      fetch(`${API_URL}?action=delete&class=${classSelect.value}&rollNo=${rollSelect.value}`)
        .then(res => res.text())
        .then(alert);
    }
  </script>
    </body>
</html>
