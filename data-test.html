<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <title>Student Results</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
        <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f6f8;
      padding: 30px;
      animation: fadeIn 0.6s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .container {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }
    img.student-photo {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 50%;
      border: 2px solid #ddd;
    }
    .modal-subjects li {
      padding: 5px 0;
    }
    .table-hover tbody tr:hover {
      background-color: #f1f1f1;
      cursor: pointer;
    }
  </style>
    </head>
    <body>
        <div class="container">
            <h2 class="mb-4">Student Results</h2>
            <div class="mb-3">
                <label for="classSelect" class="form-label">Select Class</label>
                <select id="classSelect" class="form-select">
                    <option selected disabled>Select Class</option>
                    <option value="Class_10_A">Class 10 A</option>
                    <option value="Class_10_B">Class 10 B</option>
                    <option value="Class_10_C">Class 10 C</option>
                    <option value="Class_10_D">Class 10 D</option>
                    <option value="Class_11_A">Class 11 A</option>
                    <option value="Class_11_B">Class 11 B</option>
                    <option value="Class_11_C">Class 11 C</option>
                    <option value="Class_11_D">Class 11 D</option>
                    <option value="Class_12_A">Class 12 A</option>
                    <option value="Class_12_B">Class 12 B</option>
                    <option value="Class_12_C">Class 12 C</option>
                    <option value="Class_12_D">Class 12 D</option>
                </select>
            </div>
            <table class="table table-bordered table-hover">
                <thead class="table-light">
                    <tr>
                        <th>Photo</th>
                        <th>Roll No</th>
                        <th>Name</th>
                        <th>Marks</th>
                    </tr>
                </thead>
                <tbody id="studentTableBody"></tbody>
            </table>
        </div>
        <!-- Modal -->
        <div class="modal fade" id="studentModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="studentModalLabel">Student Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p><strong>Roll Number:</strong> <span id="modalRollNo"></span></p>
                        <p><strong>Name:</strong> <span id="modalName"></span></p>
                        <ul id="modalSubjects" class="modal-subjects list-unstyled"></ul>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbx7h9ouVG-uhdSnyFlk5vTUN-WTgqT5xWNIIIlAjdjdgLYRxq_qjkN0YG7Mi6FSfQAsAA/exec';
    const classSelect = document.getElementById('classSelect');
    const tableBody = document.getElementById('studentTableBody');

    let studentData = [];

    classSelect.addEventListener('change', async () => {
      const selectedClass = classSelect.value;
      tableBody.innerHTML = `<tr><td colspan="4">Loading...</td></tr>`;

      const res = await fetch(`${API_URL}?action=getAllStudents&class=${selectedClass}`);
      const data = await res.json();
      studentData = data;

      tableBody.innerHTML = '';
      data.forEach(student => {
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td><img src="${student.photoUrl}" class="student-photo" alt="Photo"></td>
          <td>${student.rollNo}</td>
          <td>${student.name}</td>
          <td class="text-primary view-details" data-roll="${student.rollNo}" style="text-decoration: underline;">View</td>
        `;

        tableBody.appendChild(tr);
      });

      document.querySelectorAll('.view-details').forEach(cell => {
        cell.addEventListener('click', () => {
          const roll = cell.dataset.roll;
          const student = studentData.find(s => s.rollNo.toString() === roll);

          if (student) {
            document.getElementById('modalRollNo').textContent = student.rollNo;
            document.getElementById('modalName').textContent = student.name;
            const subjectList = document.getElementById('modalSubjects');
            subjectList.innerHTML = '';
            student.subjects.forEach(sub => {
              const li = document.createElement('li');
              li.innerHTML = `<strong>${sub.subject}:</strong> ${sub.marks}`;
              subjectList.appendChild(li);
            });

            const modal = new bootstrap.Modal(document.getElementById('studentModal'));
            modal.show();
          }
        });
      });
    });
  </script>
    </body>
</html>
